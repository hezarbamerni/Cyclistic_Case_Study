---
title: "Cyclistic Case Study Nov21"
author: "Hezar K"
date: "2022-11-29"
output: html_document
---

This is an analysis for Cyclistic Case Study for Google Data Analytics Course. This is an analysis for November 2021.

##### **STEP ONE:** INSTALL REQUIRED PACKAGES AND IMPORT DATA

Install the required packages. **Tidyverse** package to import and wrangling the data and **ggplot2** package for visualization of the data. **Lubridate** package for date parsing and **anytime** package for the datetime conversion.

-   install.packages("tidyverse")
-   install.packages("ggplot2")
-   install.packages("lubridate")
-   install.packages("anytime")

```{r, echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
library(tidyverse)
library(lubridate)
library(data.table)
library(ggplot2)
library(anytime)
```

Import data from local drive.

```{r, echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
Nov21 <- read_csv("C:/Users/theby/Documents/202111-divvy-tripdata.csv")
```

##### **STEP TWO:** EXAMINE THE DATA

Examine the dataframe for an overview of the data. Review column names, **colnames()**, dimensions of the dataframe by row and column, **dim()**, the first, **head()**, and the last, **tail()**, six rows in the dataframe, the summary, **summary()**, statistics on the columns of the dataframe, and review the data type structure of columns, **str()**.  

View(Nov21) 

```{r}
colnames(Nov21)
```

```{r}
nrow(Nov21)
```

```{r}
dim(Nov21) 
```

```{r}
head(Nov21) 
```

```{r}
tail(Nov21)
```

```{r}
summary(Nov21)
```

```{r}
str(Nov21)
```

Create new columns as for *date*, *month*, *day*, *year*, *day_of_week*, and *ride_length* in seconds.

```{r}
Nov21$date <- as.Date(Nov21$started_at)
Nov21$month <- format(as.Date(Nov21$date), "%m")
Nov21$month <- month.name[as.numeric(Nov21$month)]
Nov21$day <- format(as.Date(Nov21$date), "%d")
Nov21$year <- format(as.Date(Nov21$date), "%Y")
Nov21$day_of_week <- format(as.Date(Nov21$date), "%A")
Nov21$ride_length <- difftime(Nov21$ended_at,Nov21$started_at)
```

Convert *ride_length* column to numeric in order to run calculations on the data. First, check to see if the data type is numeric, and then convert if needed.

```{r}
is.numeric(Nov21$ride_length)
```

Recheck *ride_length* data type.

```{r}
Nov21$ride_length <- as.numeric(as.character(Nov21$ride_length))
is.numeric(Nov21$ride_length)
```

##### **STEP THREE:**  CLEAN DATA

**na.omit()** will remove all NA from the dataframe. 

```{r}
Nov21 <- na.omit(Nov21)
```

Remove rows with the *ride_id* column character length is not 16. This will remove all the scientific ride ids that we noticed while examining the data.

```{r}
Nov21 <- subset(Nov21, nchar(as.character(ride_id)) == 16)
```

Remove rows with the *ride_length* less than 60 seconds or 1 minute.

```{r}
Nov21 <- subset (Nov21, ride_length > 59)
```

##### **STEP FOUR:**  ANALYZE DATA

Analyze the dataframe by find the **mean**, **median**, **max** (maximum), and **min** (minimum) of *ride_length*.

```{r}
mean(Nov21$ride_length)
```

```{r}
median(Nov21$ride_length)
```

```{r}
max(Nov21$ride_length)
```

```{r}
min(Nov21$ride_length)
```

Run a statistical summary of the *ride_length*.

```{r}
summary(Nov21$ride_length)
```

Compare the members and casual users

```{r}
aggregate(Nov21$ride_length ~ Nov21$member_casual, FUN = mean)
```

```{r}
aggregate(Nov21$ride_length ~ Nov21$member_casual, FUN = median)
```

```{r}
aggregate(Nov21$ride_length ~ Nov21$member_casual, FUN = max)
```

```{r}
aggregate(Nov21$ride_length ~ Nov21$member_casual, FUN = min)
```

Aggregate the average ride length by each day of the week for members and users.

```{r}
aggregate(Nov21$ride_length ~ Nov21$member_casual + Nov21$day_of_week, FUN = mean)
```

Sort the days of the week in order.

```{r}
Nov21$day_of_week <- ordered(Nov21$day_of_week, levels=c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"))
```

Assign the aggregate the average ride length by each day of the week for members and users to x.

```{r}
x <- aggregate(Nov21$ride_length ~ Nov21$member_casual + Nov21$day_of_week, FUN = mean)

head(x)
```

Find the average ride length of member riders and casual riders per day and assign it to y.

```{r}
y <- Nov21 %>% 
  mutate(weekday = wday(started_at)) %>%
  group_by(member_casual, weekday) %>%
  summarise(number_of_rides = n(), 
            average_duration = mean(ride_length), .groups = 'drop') %>%
  arrange(member_casual, weekday)

head(y)
```

Analyze the dataframe to find the frequency of member riders, casual riders, classic bikes, docked bikes, and electric bikes.

```{r}
table(Nov21$member_casual)
table(Nov21$rideable_type)
table(Nov21$day_of_week)
```

##### **STEP FIVE:**  VISUALIZATION

Display full digits instead of scientific number.

```{r}
options(scipen=999)
```

Plot the number of rides by user type during the week.

```{r}
Nov21 %>% 
  mutate(day_of_week) %>% 
  group_by(member_casual,day_of_week) %>% 
  summarise(number_of_rides = n(), average_duration = mean(ride_length), .groups = 'drop') %>% 
  arrange(member_casual, day_of_week)  %>% 
  ggplot(aes(x = day_of_week, y = number_of_rides, fill = member_casual)) +
  geom_col(position = "dodge")+
labs(x = "Days of Week",
     y= "Number of Rides", 
     title= "Days of the Week")
```

Plot the duration of the ride by user type during the week.

```{r}
Nov21 %>% 
  mutate(day_of_week) %>% 
  group_by(member_casual, day_of_week) %>% 
  summarise(number_of_rides = n(), average_duration = mean(ride_length), .groups = 'drop') %>% 
  arrange(member_casual, day_of_week)  %>% 
  ggplot(aes(x = day_of_week, y = average_duration, fill = member_casual)) +
  geom_col(position = "dodge") +
  labs(x = "Days of Week",
       y= "Average Duration in Seconds", 
       title= "Days of the Week vs Average Duration")
```

Create new dataframe for plots for weekday trends vs weekend trends.

```{r}
mc<- as.data.frame(table(Nov21$day_of_week,Nov21$member_casual))
```

Rename columns

```{r}
mc<-rename(mc, day_of_week = Var1, member_casual = Var2)

head(mc)
```

Weekday trends (Monday through Friday).

```{r}
mc %>%
  filter(day_of_week == "Monday" |
           day_of_week == "Tuesday" |
           day_of_week == "Wednesday" |
           day_of_week == "Thursday" |
           day_of_week == "Friday") %>%
  ggplot(aes(x = day_of_week, y = Freq, fill = member_casual))+
  geom_bar(stat = "identity" , position = "dodge") +
  labs(title = "Weekdays Trends",
       x= "Days Of The Week",
       y = "Number of Rides")
```

Weekend trends (Sunday and Saturday).

```{r}
mc %>%
  filter(day_of_week == "Sunday" |
           day_of_week == "Saturday") %>%
  ggplot(aes(x = day_of_week, y = Freq, fill = member_casual))+
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Weekends Trends",
       x= "Sunday vs Saturday",
       y = "Number of Rides")
```

Create dataframe for member and casual riders vs ride type

```{r}
rt<- as.data.frame(table(Nov21$rideable_type,Nov21$member_casual))
```

Rename columns.

```{r}
rt<-rename(rt, rideable_type = Var1, member_casual = Var2)

head(rt)
```

Plot for bike user vs bike type.

```{r}
rt %>%
  filter(member_casual == "member" |
           member_casual == "casual") %>%
  ggplot(aes(x = rideable_type, y = Freq, fill = member_casual))+
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Riders and Ride Types",
       x= "Rideable Types",
       y = "Number of Rides")
```

##### **STEP SIX:**  EXPORT ANALYZED DATA

Save the analyzed data as a new file.
fwrite(Nov21, "Nov21.csv")